--
title: "Final Project Coffe Analysis "
author: "Ariana Marastutir"
date: "5/06/2022"
output: 
  html_document: 
    keep_md: yes
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# Spotify data analysis

# Introduction

The objective of this project is to explore the contributing factors in deterimning the quality of the coffe bean. 

The background underlying of this analysis is to get a better understanding of the behavior of music when listening to songs on Spotify. In this analysis I will explore the feature of a song and its effect to the popularity of a song based on a Spotify data set from the TidyTuesday series. Specifically, there are several subgoals of the analyses: 1) To explore the popular song and genre and their characteristics, and 2) to predict the `track_popularity` of a song based on the features of a song (`danceability`, `energy`, `loudness`, `speechiness`, `acousticness`, `instrumentalness`, `liveness`, `valence`, `tempo`, `duration_ms`) using multiple linear regression analysis. After cleaning the data, I will explore the variables and carefully constructed ggplots to conduct numerical and visual analyses.

## Loading Library and Data
The data used in this project was obtained from the [GitHub TidyTuesday project](coffee_ratings <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-07-07/coffee_ratings.csv')



```{r}
library(tidyverse)
library(DT)
library(psych)
library(car)
library(broom)
```

```{r}
coffee_ratings <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-07-07/coffee_ratings.csv')

```
##Preliminary Exploration and Data Cleaning

```{r}
glimpse(coffee_ratings)
```
There are some variables need to be convert to other data type due to the nature and structure of the data 

```{r}
coffee_ratings <- coffee_ratings %>%
  mutate(species = as.factor(species),
  owner = as.factor(owner),
  country_of_origin = as.factor(country_of_origin),
  farm_name = as.factor(farm_name),
  company = as.factor(company),
mill=as.factor(mill),
altitude = as.factor(altitude),
region = as.factor(region),
producer = as.factor(producer),
bag_weight =as.factor(bag_weight),
in_country_partner= as.factor(in_country_partner),
harvest_year= as.factor(harvest_year),
grading_date = as.factor(grading_date),
owner_1 = as.factor(owner_1),
variety = as.factor(variety),
processing_method = as.factor(processing_method),
color = as.factor(color),
expiration = as.factor (expiration),
certification_body = as.factor(certification_body),
certification_address = as.factor(certification_address),
certification_contact = as.factor(certification_contact),
unit_of_measurement = as.factor(unit_of_measurement))

glimpse(coffee_ratings)
```
### Missing value
```{r}
colSums(is.na(coffee_ratings))
coffee_ratings <- coffee_ratings %>%
  filter(total_cup_points!= " ")
```
# Removing irrelavant variables 
```{r}
coffee_new <-coffee_ratings %>%
  select(total_cup_points, species, country_of_origin, region, altitude, producer, variety, aroma, processing_method, flavor, aftertaste, acidity, body, balance, uniformity, clean_cup, sweetness,cupper_points, moisture, category_one_defects, category_two_defects, quakers, color, altitude_low_meters, altitude_mean_meters, altitude_high_meters)
glimpse(coffee_new)
```
There are some variables dropped from the data set, since irrelevant variables to this analysis.  


```{r}
coffee_relevant <-coffee_ratings %>%
  select(total_cup_points, species, aroma, processing_method, flavor, aftertaste, acidity, body, balance, uniformity, clean_cup, sweetness,cupper_points)
glimpse(coffee_relevant)
```
converting variables to integer

```{r}
coffee_relevant<- coffee_relevant %>%
  mutate(total_cup_points = as.integer(total_cup_points),
    aroma = as.integer(aroma),
    flavor = as.integer(flavor),
    aftertaste = as.integer(aftertaste),
    acidity= as.integer(acidity),
    body= as.integer(body),
    balance= as.integer(balance),
    uniformity= as.integer(uniformity),
    clean_cup= as.integer(clean_cup),
    sweetness= as.integer(sweetness),
    cupper_points= as.integer(cupper_points))
glimpse(coffee_relevant)    
```
```{r}
coffee_relevant<- coffee_relevant %>%
  mutate(total_cup_points = as.numeric(total_cup_points),
    aroma = as.numeric(aroma),
    flavor = as.numeric(flavor),
    aftertaste = as.numeric(aftertaste),
    acidity= as.numeric(acidity),
    body= as.numeric(body),
    balance= as.numeric(balance),
    uniformity= as.numeric(uniformity),
    clean_cup= as.numeric(clean_cup),
    sweetness= as.numeric(sweetness),
    cupper_points= as.numeric(cupper_points))
glimpse(coffee_relevant)    
```


### Histogram of the coffe features

```{r}

```
##EDA

## Correlation matrix
```{r}
cor(coffee_relevant[sapply(coffee_relevant,is.numeric)])
```
summary of correlation :
- The highest correlation is between flavor and total_cup_points
- All the variables have a positive correlation, no variables have a negative correlation.

# Regression analysis on the total cup points

Model overall regression is directed to predict the total cup points based on the all variables predictors

```{r}
model<- lm(total_cup_points ~ aroma+ flavor+aftertaste+acidity+body+balance+uniformity+clean_cup+sweetness+cupper_points, data = coffee_relevant)
summary(model)
```
## Checking for influential outliers
```{r}
cooksd <- cooks.distance(model)

plot(cooksd, pch="*", cex=2, main="Influential Obs by Cooks distance")
abline(h = 3*mean(cooksd, na.rm=T), col="red")
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=T),names(cooksd),""), col="red")

```

```{r}
coffe_clean <- coffee_relevant[-1311, ]
```

```{r}
model<- lm(total_cup_points ~ aroma+ flavor+aftertaste+acidity+body+balance+uniformity+clean_cup+sweetness+cupper_points, data = coffe_clean)
summary(model)
```
## Assumption checking
### Linearity
```{r}
plot(model, which =1 )
```

### Normality of residual
```{r}
plot(model, which = 2)
```


### Homogenety of variance
```{r}
plot(model, which=3)
```

### Multicolinearity
```{r}
vif(model)
```

All variables have VIF below 5 which mean that there is no problem with multicolinearity .


## Model comparison
### Model 1- simple

```{r}
model1 <- lm(total_cup_points ~ aftertaste + acidity+clean_cup, data = coffe_clean)

summary(model1)
```
The model simultaneously can predict after cup points with F(3, 1334)=968,9, p<0.001. All predictors can explain 68% variance of the total cup of points. 

### Model 2 : complex
```{r}
model2 <- lm(total_cup_points ~ aftertaste + acidity+clean_cup+aroma+balance+uniformity, data=coffe_clean)
summary(model2)
```
The model simultaneously can predict after cup points with F(3, 1331)=741.7, p<0.001. All predictors can explain 76% variance of the total cup of points. 
### Comparing the two model

```{r}
anova(model1, model2)
sum_model1 <- glance(model1)
sum_model2 <- glance(model2)

comparison_mod <- sum_model1%>%
  rbind(sum_model2) %>%
  mutate(model= c ("simple", "complex")) %>%
  relocate (model) %>%
  as.data.frame()
comparison_mod
```
AIC score of simple model (4916,48) is higher than complex model (4504,82), so it can be concluded that simple model is better in explaining the predictor of the total cup points of the coffee ratings. 


